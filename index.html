<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitPlan: ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏î‡πâ‡∏ß‡∏¢ Bitcoin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px;
            border-radius: 50%; background: #4F46E5; cursor: pointer; margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #E5E7EB; border-radius: 2px;
        }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="max-w-5xl mx-auto p-4 md:p-8">
        
        <!-- Header -->
        <header class="mb-6 text-center">
            <div class="flex items-center justify-center gap-3 mb-2">
                <span class="text-4xl">üöÄ</span>
                <h1 class="text-3xl md:text-4xl font-bold text-indigo-800">BitPlan</h1>
            </div>
            <p class="text-indigo-600 font-medium">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏î‡πâ‡∏ß‡∏¢ Bitcoin</p>
            
            <!-- Live Market Status Bar -->
            <div class="inline-flex flex-col md:flex-row items-center gap-2 md:gap-6 bg-white px-6 py-3 rounded-full shadow-sm border border-indigo-100 mt-6">
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <span class="text-lg">üïí</span>
                    <span id="liveClock" class="font-mono font-bold w-36 text-center">-</span>
                </div>
                <div class="hidden md:block h-4 w-px bg-gray-300"></div>
                <div class="flex items-center gap-2 text-sm">
                    <span class="text-lg">üè∑Ô∏è</span>
                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤ BTC ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</span>
                    <span id="livePriceDisplay" class="font-mono font-bold text-indigo-600 text-lg">Loading...</span>
                    <button onclick="fetchPrice(true)" class="ml-2 p-1 rounded-full hover:bg-gray-100 text-gray-400 transition-colors" title="‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Inputs (5 cols) -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Card 1: Profile -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
                        <span>üë§</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                    </h2>

                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div>
                            <label class="block text-[10px] font-medium text-gray-500 mb-1">‡∏≠‡∏≤‡∏¢‡∏∏‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                            <input type="number" id="currentAgeInput" value="30" min="1" max="99" class="w-full p-2 border rounded-lg font-bold text-indigo-600 text-center focus:ring-2 focus:ring-indigo-200 outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-medium text-gray-500 mb-1">‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ï‡∏≠‡∏ô</label>
                            <input type="number" id="retireAgeInput" value="60" min="1" max="99" class="w-full p-2 border rounded-lg font-bold text-gray-700 text-center focus:ring-2 focus:ring-indigo-200 outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-medium text-gray-500 mb-1">‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ñ‡∏∂‡∏á</label>
                            <input type="number" id="dieAgeInput" value="80" min="1" max="120" class="w-full p-2 border rounded-lg font-bold text-gray-700 text-center focus:ring-2 focus:ring-indigo-200 outline-none bg-orange-50 border-orange-100">
                        </div>
                    </div>
                    
                    <div class="text-xs text-gray-400 text-center mb-4 bg-slate-50 rounded py-1">
                        ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì: <span id="retirementDurationLabel" class="font-bold text-indigo-600">20</span> ‡∏õ‡∏µ
                    </div>

                    <div class="mb-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">üí∞ Bitcoin ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (BTC)</label>
                        <input type="number" id="currentBTCInput" step="0.00000001" value="0" class="w-full p-3 border-2 border-indigo-100 focus:border-indigo-500 rounded-lg font-mono font-bold text-lg text-right text-indigo-700 placeholder-gray-300 outline-none transition-colors" placeholder="0.00000000">
                        <p class="text-xs text-gray-400 mt-1 text-right">‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</p>
                    </div>
                </div>

                <!-- Card 2: Lifestyle & Inflation -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
                        <span>üõí</span> ‡πÑ‡∏•‡∏ü‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ (‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</label>
                        <div class="flex items-center gap-3">
                            <input type="range" id="monthlyExpense" min="10000" max="200000" step="5000" value="30000" class="w-full accent-indigo-600">
                            <input type="number" id="monthlyExpenseNum" value="30000" class="w-24 p-2 border rounded-lg text-right font-bold text-gray-700 focus:ring-2 focus:ring-indigo-200 outline-none">
                        </div>
                        <p class="text-xs text-gray-400 mt-1">‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏Å‡∏¥‡∏ô, ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß, ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</p>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (%)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="inflationRate" value="3.0" step="0.1" class="w-20 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-200 outline-none">
                            <span class="text-xs text-gray-400">‡∏ï‡πà‡∏≠‡∏õ‡∏µ (‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô 3%)</span>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Future Price -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
                        <span>üöÄ</span> ‡∏£‡∏≤‡∏Ñ‡∏≤ Bitcoin ‡∏ï‡∏≠‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì
                    </h2>
                    <select id="btcPriceScenario" class="w-full p-2 border rounded-lg mb-2 bg-slate-50 text-sm focus:ring-2 focus:ring-indigo-200 outline-none">
                        <option value="10000000">Bear Case (10 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó) - ‡πÅ‡∏Ñ‡πà‡∏ä‡∏ô‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠</option>
                        <option value="50000000" selected>Base Case (50 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó) - ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</option>
                        <option value="100000000">Bull Case (100 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó) - ‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å</option>
                    </select>
                    <div class="flex justify-between items-center bg-slate-50 p-2 rounded-lg border border-slate-100">
                         <span class="text-xs text-gray-500">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (THB):</span>
                         <input type="number" id="btcFuturePrice" value="50000000" class="w-32 p-1 border-none bg-transparent font-mono text-right font-bold text-gray-600" disabled>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results (7 cols) -->
            <div class="lg:col-span-7 flex flex-col gap-6">
                
                <!-- Result Box -->
                <div class="bg-gradient-to-br from-indigo-900 to-indigo-800 text-white p-6 md:p-8 rounded-2xl shadow-xl relative overflow-hidden flex-grow flex flex-col justify-center">
                    <div class="absolute top-0 right-0 -mt-16 -mr-16 w-64 h-64 bg-indigo-500 rounded-full opacity-20 blur-3xl"></div>
                    
                    <div class="relative z-10">
                        <p class="text-center text-indigo-200 text-sm mb-4" id="headerSubText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...</p>
                        
                        <div class="flex justify-between items-end mb-2 border-b border-white/10 pb-4">
                            <h3 class="text-indigo-100 text-sm uppercase font-bold tracking-wider" id="cashNeededLabel">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (20 ‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì)</h3>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-white" id="totalCashNeeded">0 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó</p>
                                <p class="text-xs text-indigo-300">‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß</p>
                            </div>
                        </div>
                        
                        <div class="bg-black/20 rounded-xl p-6 mb-6 backdrop-blur-sm border border-white/10 mt-4">
                            <div class="flex flex-col md:flex-row items-baseline gap-4 justify-between">
                                <div>
                                    <p class="text-sm text-indigo-200 mb-1">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Bitcoin ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                    <div class="flex items-baseline gap-2">
                                        <span class="text-5xl font-bold text-white tracking-tight" id="targetBTC">0.0000</span>
                                        <span class="text-xl text-orange-400 font-bold">BTC</span>
                                    </div>
                                </div>
                                <div class="text-right md:border-l md:border-white/10 md:pl-6 w-full md:w-auto">
                                    <p class="text-sm text-indigo-200 mb-1">‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å (Shortfall)</p>
                                    <p class="text-3xl font-bold text-yellow-300" id="shortfallBTC">0.0000</p>
                                    <p class="text-xs text-indigo-400">‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà <span id="displayUserBTC">0.00</span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Plan Section -->
                        <div class="bg-white text-gray-800 rounded-xl p-6 shadow-lg transform transition-all hover:scale-[1.01]">
                            <h4 class="flex items-center gap-2 font-bold text-indigo-800 text-lg mb-4">
                                üìÖ ‡πÅ‡∏ú‡∏ô‡∏≠‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (DCA)
                                <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded-full">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ <span id="monthsRemaining">0</span> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                            </h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-center gap-4">
                                    <div class="p-3 bg-orange-100 text-orange-600 rounded-lg">
                                        <!-- Bitcoin Icon -->
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.55-2.5h-1.1v-1.11c-1.66-.23-2.95-1.64-2.95-3.39 0-1.4.93-2.68 2.29-3.07v-2.68c-.74.24-1.27.82-1.47 1.53l-1.04-.28c.27-1.04 1.1-1.88 2.17-2.21V5.5h1.1v1.1c1.69.23 2.99 1.66 2.99 3.42 0 1.41-.94 2.68-2.29 3.09v2.71c.76-.24 1.3-.82 1.5-1.56l1.03.31c-.29 1.1-1.15 1.97-2.24 2.28v1.15z"/></svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ (BTC)</p>
                                        <p class="text-2xl font-bold text-gray-800" id="monthlyBTCTarget">0.000000</p>
                                    </div>
                                </div>

                                <div class="flex items-center gap-4 border-t md:border-t-0 md:border-l border-gray-100 pt-4 md:pt-0 md:pl-4">
                                    <div class="p-3 bg-green-100 text-green-600 rounded-lg">
                                        <!-- Money Icon -->
                                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≤‡∏ó (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)*</p>
                                        <p class="text-2xl font-bold text-green-600" id="monthlyTHBTarget">Loading...</p>
                                        <p class="text-[10px] text-gray-400" id="priceReferenceLabel">*‡∏≠‡∏¥‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ BTC ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Footer Note -->
                <div class="bg-yellow-50 border border-yellow-100 rounded-lg p-4 text-xs text-yellow-800 flex gap-3 items-start">
                    <span class="text-xl">üí°</span>
                    <p>
                        <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ Bitcoin ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå) ‡∏ñ‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≤‡∏ó‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ BTC ‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏™‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <strong>BTC</strong> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö
                    </p>
                </div>
            </div>
        </div>
        
        <footer class="mt-8 text-center text-gray-400 text-xs pb-4">
            <p>¬© 2025 BitPlan Calculator. ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏ß‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏•‡∏á‡∏ó‡∏∏‡∏ô</p>
        </footer>

    </div>

    <script>
        // --- Variables ---
        let currentBTCPrice = 3000000; // Fallback price

        // --- Elements ---
        const currentAgeInput = document.getElementById('currentAgeInput');
        const retireAgeInput = document.getElementById('retireAgeInput');
        const dieAgeInput = document.getElementById('dieAgeInput');
        
        const currentBTCInput = document.getElementById('currentBTCInput');
        const headerSubText = document.getElementById('headerSubText');
        const retirementDurationLabel = document.getElementById('retirementDurationLabel');
        const cashNeededLabel = document.getElementById('cashNeededLabel');
        
        const monthlyExpenseSlider = document.getElementById('monthlyExpense');
        const monthlyExpenseNum = document.getElementById('monthlyExpenseNum');
        const inflationRateInput = document.getElementById('inflationRate');
        
        const btcPriceScenario = document.getElementById('btcPriceScenario');
        const btcFuturePriceInput = document.getElementById('btcFuturePrice');
        
        // Results Elements
        const targetBTCDisplay = document.getElementById('targetBTC');
        const totalCashNeededDisplay = document.getElementById('totalCashNeeded');
        const shortfallBTCDisplay = document.getElementById('shortfallBTC');
        const displayUserBTC = document.getElementById('displayUserBTC');
        
        const monthsRemainingDisplay = document.getElementById('monthsRemaining');
        const monthlyBTCTargetDisplay = document.getElementById('monthlyBTCTarget');
        const monthlyTHBTargetDisplay = document.getElementById('monthlyTHBTarget');
        const priceReferenceLabel = document.getElementById('priceReferenceLabel');

        // Header Live Elements
        const liveClock = document.getElementById('liveClock');
        const livePriceDisplay = document.getElementById('livePriceDisplay');

        // --- Logic ---

        // 1. Time Logic
        function updateClock() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' });
            const timeStr = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            liveClock.innerText = `${dateStr} ${timeStr}`;
        }
        setInterval(updateClock, 1000);
        updateClock(); // First run

        // 2. Fetch Logic
        async function fetchPrice(manual = false) {
            if(manual) {
                livePriceDisplay.innerText = "Updating...";
            }

            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=thb');
                const data = await response.json();
                
                if (data.bitcoin && data.bitcoin.thb) {
                    currentBTCPrice = data.bitcoin.thb;
                    livePriceDisplay.innerText = `‡∏ø${currentBTCPrice.toLocaleString()}`;
                    livePriceDisplay.classList.remove('text-red-500');
                    livePriceDisplay.classList.add('text-indigo-600');
                    
                    // Update label
                    priceReferenceLabel.innerText = `*‡∏≠‡∏¥‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ BTC ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (${new Date().toLocaleTimeString('th-TH')})`;
                    
                    // Re-calculate
                    calculateRetirement();
                }
            } catch (error) {
                console.error("Failed to fetch price:", error);
                if (manual) {
                    livePriceDisplay.innerText = "Error";
                    setTimeout(() => livePriceDisplay.innerText = `‡∏ø${currentBTCPrice.toLocaleString()}`, 2000);
                }
            }
        }
        
        fetchPrice();
        setInterval(() => fetchPrice(), 60000);


        // 3. Calculation Logic
        function calculateRetirement() {
            // Inputs
            let age = parseInt(currentAgeInput.value) || 30;
            let retireAge = parseInt(retireAgeInput.value) || 60;
            let dieAge = parseInt(dieAgeInput.value) || 80;
            
            // Validations
            if(age < 1) age = 1;
            if(retireAge <= age) retireAge = age + 1; // Ensure retirement is in future
            if(dieAge <= retireAge) dieAge = retireAge + 1; // Ensure die age is after retirement

            let yearsToInvest = retireAge - age;
            let monthsToInvest = yearsToInvest * 12;
            let yearsRetirement = dieAge - retireAge;
            
            // Update labels
            headerSubText.innerText = `‡∏≠‡∏≤‡∏¢‡∏∏ ${age} ‡∏õ‡∏µ ‚ûî ‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡∏° ${yearsToInvest} ‡∏õ‡∏µ`;
            retirementDurationLabel.innerText = yearsRetirement;
            cashNeededLabel.innerText = `‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (${yearsRetirement} ‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì)`;

            let currentMonthlyExpense = parseInt(monthlyExpenseNum.value) || 0;
            let inflationRate = parseFloat(inflationRateInput.value) / 100;
            let futureBTCPrice = parseInt(btcFuturePriceInput.value);
            let userBTC = parseFloat(currentBTCInput.value) || 0;

            // Calculate Future Expense (FV of monthly expense at retirement age)
            let futureMonthlyExpense = currentMonthlyExpense * Math.pow((1 + inflationRate), yearsToInvest);
            
            // Total Cash Needed (Monthly * 12 * Years in Retirement)
            // Note: ideally we should account for inflation *during* retirement too, 
            // but keeping it simple (flat future expense) for estimation as per original logic.
            let totalCashNeeded = futureMonthlyExpense * 12 * yearsRetirement;

            // Target BTC
            let targetBTC = totalCashNeeded / futureBTCPrice;

            // Shortfall
            let shortfall = targetBTC - userBTC;
            if (shortfall < 0) shortfall = 0;

            // Monthly Plan
            let monthlyBTCNeeded = shortfall / monthsToInvest;
            let monthlyTHBEst = monthlyBTCNeeded * currentBTCPrice; // Use dynamic price

            // Update UI
            targetBTCDisplay.innerText = targetBTC.toFixed(4);
            totalCashNeededDisplay.innerText = (totalCashNeeded / 1000000).toFixed(2) + " ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó"; 
            
            displayUserBTC.innerText = userBTC.toFixed(8);
            shortfallBTCDisplay.innerText = shortfall.toFixed(4);
            
            monthsRemainingDisplay.innerText = monthsToInvest;
            
            // Monthly Targets
            if(monthlyBTCNeeded > 0 && monthsToInvest > 0) {
                monthlyBTCTargetDisplay.innerText = monthlyBTCNeeded.toFixed(6);
                monthlyTHBTargetDisplay.innerText = Math.ceil(monthlyTHBEst).toLocaleString() + " ‡∏ö‡∏≤‡∏ó";
            } else {
                monthlyBTCTargetDisplay.innerText = "0.000000";
                monthlyTHBTargetDisplay.innerText = "‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!";
            }
        }

        // --- Event Listeners ---
        currentAgeInput.addEventListener('input', calculateRetirement);
        retireAgeInput.addEventListener('input', calculateRetirement);
        dieAgeInput.addEventListener('input', calculateRetirement);
        currentBTCInput.addEventListener('input', calculateRetirement);
        
        monthlyExpenseSlider.addEventListener('input', (e) => {
            monthlyExpenseNum.value = e.target.value;
            calculateRetirement();
        });

        monthlyExpenseNum.addEventListener('input', (e) => {
            monthlyExpenseSlider.value = e.target.value;
            calculateRetirement();
        });

        inflationRateInput.addEventListener('input', calculateRetirement);

        btcPriceScenario.addEventListener('change', (e) => {
            btcFuturePriceInput.value = e.target.value;
            calculateRetirement();
        });

        // Init
        calculateRetirement();

    </script>
</body>
</html>
