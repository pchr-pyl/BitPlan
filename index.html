<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitPlan Pro: ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3YPRGR2BEX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-3YPRGR2BEX');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px;
            border-radius: 50%; background: #4F46E5; cursor: pointer; margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #E5E7EB; border-radius: 2px;
        }
        .input-group:focus-within label { color: #4F46E5; }
        .input-group:focus-within input { border-color: #4F46E5; box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        
        <!-- Header -->
        <header class="mb-6 text-center">
            <div class="flex items-center justify-center gap-3 mb-2">
                <span class="text-4xl">üíº</span>
                <h1 class="text-3xl md:text-4xl font-bold text-indigo-800">BitPlan Pro</h1>
            </div>
            <p class="text-indigo-600 font-medium">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (Holistic Wealth Planner)</p>
            
            <!-- Live Market Status Bar -->
            <div class="inline-flex flex-col md:flex-row items-center gap-2 md:gap-6 bg-white px-6 py-3 rounded-full shadow-sm border border-indigo-100 mt-6">
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <span class="text-lg">üïí</span>
                    <span id="liveClock" class="font-mono font-bold w-36 text-center">-</span>
                </div>
                <div class="hidden md:block h-4 w-px bg-gray-300"></div>
                <div class="flex items-center gap-2 text-sm">
                    <span class="text-lg">üè∑Ô∏è</span>
                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤ BTC:</span>
                    <span id="livePriceDisplay" class="font-mono font-bold text-indigo-600 text-lg">Loading...</span>
                    <button onclick="fetchPrice(true)" class="ml-2 p-1 rounded-full hover:bg-gray-100 text-gray-400 transition-colors" title="‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Inputs (5 cols) -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Card 1: Profile -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                    <h2 class="text-md font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
                        <span>üë§</span> ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
                    </h2>
                    <div class="grid grid-cols-3 gap-3 mb-2">
                        <div>
                            <label class="block text-[10px] font-medium text-gray-500 mb-1">‡∏≠‡∏≤‡∏¢‡∏∏‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                            <input type="number" id="currentAgeInput" value="30" min="1" max="99" class="w-full p-2 border rounded-lg font-bold text-indigo-600 text-center focus:ring-2 focus:ring-indigo-200 outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-medium text-gray-500 mb-1">‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ï‡∏≠‡∏ô</label>
                            <input type="number" id="retireAgeInput" value="60" min="1" max="99" class="w-full p-2 border rounded-lg font-bold text-gray-700 text-center focus:ring-2 focus:ring-indigo-200 outline-none text-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-medium text-gray-500 mb-1">‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ñ‡∏∂‡∏á</label>
                            <input type="number" id="dieAgeInput" value="80" min="1" max="120" class="w-full p-2 border rounded-lg font-bold text-gray-700 text-center focus:ring-2 focus:ring-indigo-200 outline-none bg-orange-50 border-orange-100 text-sm">
                        </div>
                    </div>
                    <div class="text-xs text-gray-400 text-center mb-1 bg-slate-50 rounded py-1">
                        ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡∏°: <span id="savingDurationLabel" class="font-bold text-green-600">30</span> ‡∏õ‡∏µ | 
                        ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô: <span id="retirementDurationLabel" class="font-bold text-orange-600">20</span> ‡∏õ‡∏µ
                    </div>
                </div>

                <!-- Card 2: Portfolio Allocation (New!) -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 ring-1 ring-indigo-50">
                    <h2 class="text-md font-bold text-indigo-800 mb-4 border-b pb-2 flex items-center gap-2 justify-between">
                        <span class="flex items-center gap-2"><span>üìä</span> ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                        <span class="text-xs font-normal text-gray-400 bg-gray-100 px-2 py-1 rounded-full">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°: <span id="totalAssetsDisplay" class="font-bold text-indigo-600">0</span> ‡∏ö.</span>
                    </h2>
                    
                    <div class="space-y-3">
                        <!-- Bitcoin (Special) -->
                        <div class="input-group">
                            <label class="block text-xs font-medium text-gray-500 mb-1 flex justify-between">
                                <span>Bitcoin (BTC)</span>
                                <span class="text-indigo-400" id="btcValueTHB">‚âà 0 ‡∏ö‡∏≤‡∏ó</span>
                            </label>
                            <div class="relative">
                                <input type="number" id="currentBTCInput" step="0.00000001" value="0" class="w-full p-2 pl-3 pr-12 border rounded-lg font-mono font-bold text-indigo-700 bg-indigo-50/30 text-sm transition-colors outline-none" placeholder="0.00000000">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-400 text-xs">BTC</span>
                                </div>
                            </div>
                        </div>

                        <!-- Other Assets Grid -->
                        <div class="grid grid-cols-2 gap-3">
                            <div class="input-group">
                                <label class="block text-xs font-medium text-gray-500 mb-1">‡∏´‡∏∏‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="assetStock" value="0" class="w-full p-2 border rounded-lg text-right text-sm outline-none text-gray-700">
                            </div>
                            <div class="input-group">
                                <label class="block text-xs font-medium text-gray-500 mb-1">‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="assetGold" value="0" class="w-full p-2 border rounded-lg text-right text-sm outline-none text-gray-700">
                            </div>
                            <div class="input-group">
                                <label class="block text-xs font-medium text-gray-500 mb-1">Crypto ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="assetOtherCrypto" value="0" class="w-full p-2 border rounded-lg text-right text-sm outline-none text-gray-700">
                            </div>
                            <div class="input-group">
                                <label class="block text-xs font-medium text-gray-500 mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å/‡∏™‡∏î (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="assetCash" value="0" class="w-full p-2 border rounded-lg text-right text-sm outline-none text-gray-700">
                            </div>
                            <div class="input-group col-span-2">
                                <label class="block text-xs font-medium text-gray-500 mb-1">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô (RMF/SSF/PVD)</label>
                                <input type="number" id="assetFunds" value="0" class="w-full p-2 border rounded-lg text-right text-sm outline-none text-gray-700">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Lifestyle & Goal -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                    <h2 class="text-md font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
                        <span>üéØ</span> ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-600 mb-1">‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ (‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</label>
                        <div class="flex items-center gap-3">
                            <input type="range" id="monthlyExpense" min="10000" max="200000" step="5000" value="30000" class="w-full accent-indigo-600">
                            <input type="number" id="monthlyExpenseNum" value="30000" class="w-24 p-2 border rounded-lg text-right font-bold text-gray-700 text-sm outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                             <label class="block text-xs font-medium text-gray-500 mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (%)</label>
                            <input type="number" id="inflationRate" value="3.0" step="0.1" class="w-full p-2 border rounded-lg text-center outline-none text-sm">
                        </div>
                        <div>
                             <label class="block text-xs font-medium text-gray-500 mb-1">BTC ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (‡∏ö‡∏≤‡∏ó)</label>
                             <select id="btcPriceScenario" class="w-full p-2 border rounded-lg bg-slate-50 text-xs outline-none mb-1">
                                <option value="10000000">Bear (10M)</option>
                                <option value="50000000" selected>Base (50M)</option>
                                <option value="100000000">Bull (100M)</option>
                                <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á...</option>
                            </select>
                            <input type="number" id="btcFuturePrice" value="50000000" class="w-full p-2 border rounded-lg text-right text-sm bg-gray-100 text-gray-500 outline-none focus:ring-2 focus:ring-indigo-200 focus:bg-white transition-all" disabled>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Dashboard (7 cols) -->
            <div class="lg:col-span-7 flex flex-col gap-6">
                
                <!-- Main Dashboard -->
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl relative overflow-hidden flex-grow">
                    <!-- BG Graphic -->
                    <div class="absolute top-0 right-0 -mt-10 -mr-10 w-64 h-64 bg-indigo-500 rounded-full opacity-10 blur-3xl"></div>
                    
                    <div class="relative z-10">
                        
                        <!-- Top Row: Goal vs Current -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 border-b border-slate-600 pb-6 mb-6">
                            <div>
                                <p class="text-slate-400 text-xs uppercase tracking-wide mb-1">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠)</p>
                                <p class="text-3xl font-bold text-white" id="totalCashNeeded">0.00 M</p>
                                <p class="text-xs text-slate-500 mt-1">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏î‡πâ 20 ‡∏õ‡∏µ</p>
                            </div>
                            <div class="md:text-right">
                                <p class="text-slate-400 text-xs uppercase tracking-wide mb-1">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                                <p class="text-3xl font-bold text-indigo-400" id="currentNetWorth">0.00 M</p>
                                <p class="text-xs text-slate-500 mt-1" id="assetsBreakdownLabel">BTC + Stocks + Gold + Others</p>
                            </div>
                        </div>

                        <!-- Shortfall Section -->
                        <div class="bg-slate-900/50 rounded-xl p-6 border border-slate-700 backdrop-blur-sm">
                            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                                <div>
                                    <p class="text-sm text-slate-300 mb-2 flex items-center gap-2">
                                        <span class="w-2 h-2 bg-red-500 rounded-full"></span> 
                                        ‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å (Shortfall Gap)
                                    </p>
                                    <p class="text-4xl font-bold text-red-400" id="shortfallTHB">0 ‡∏ö‡∏≤‡∏ó</p>
                                    <p class="text-xs text-slate-500 mt-1">‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô <span id="yearsToInvestLabel">0</span> ‡∏õ‡∏µ</p>
                                </div>
                                
                                <!-- Arrow -->
                                <div class="hidden md:block text-slate-600">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                                </div>

                                <!-- Target BTC -->
                                <div class="text-right bg-indigo-900/30 p-4 rounded-lg border border-indigo-500/30">
                                    <p class="text-xs text-indigo-200 mb-1">‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ BTC</p>
                                    <p class="text-3xl font-bold text-yellow-400" id="shortfallBTC">0.0000</p>
                                    <p class="text-xs text-indigo-300">BTC</p>
                                </div>
                            </div>
                        </div>

                        <!-- Action Plan -->
                        <div class="mt-6 pt-4">
                            <h4 class="text-indigo-300 text-sm font-bold mb-4 flex items-center gap-2">
                                üìÖ ‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ (DCA Plan)
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-white text-slate-800 p-4 rounded-lg flex items-center gap-3 shadow-lg">
                                    <div class="p-2 bg-orange-100 text-orange-600 rounded-md">
                                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.55-2.5h-1.1v-1.11c-1.66-.23-2.95-1.64-2.95-3.39 0-1.4.93-2.68 2.29-3.07v-2.68c-.74.24-1.27.82-1.47 1.53l-1.04-.28c.27-1.04 1.1-1.88 2.17-2.21V5.5h1.1v1.1c1.69.23 2.99 1.66 2.99 3.42 0 1.41-.94 2.68-2.29 3.09v2.71c.76-.24 1.3-.82 1.5-1.56l1.03.31c-.29 1.1-1.15 1.97-2.24 2.28v1.15z"/></svg>
                                    </div>
                                    <div>
                                        <p class="text-xs text-slate-500">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ (BTC)</p>
                                        <p class="text-xl font-bold text-indigo-700" id="monthlyBTCTarget">0.000000</p>
                                    </div>
                                </div>
                                <div class="bg-slate-700/50 text-slate-200 p-4 rounded-lg flex items-center gap-3 border border-slate-600">
                                    <div>
                                        <p class="text-xs text-slate-400">‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≤‡∏ó (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</p>
                                        <p class="text-xl font-bold text-green-400" id="monthlyTHBTarget">0 ‡∏ö‡∏≤‡∏ó</p>
                                        <p class="text-[10px] text-slate-500">*‡∏≠‡∏¥‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ BTC ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Footer Note -->
                <div class="bg-white border border-indigo-100 rounded-lg p-4 text-xs text-slate-500">
                    <p><strong>üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ô‡∏≥‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏´‡∏∏‡πâ‡∏ô, ‡∏ó‡∏≠‡∏á, ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô) ‡∏°‡∏≤‡∏´‡∏±‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ Conservative Plan) ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô Bitcoin ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Variables ---
        let currentBTCPrice = 3000000; // Default fallback

        // --- Elements ---
        // Profile
        const currentAgeInput = document.getElementById('currentAgeInput');
        const retireAgeInput = document.getElementById('retireAgeInput');
        const dieAgeInput = document.getElementById('dieAgeInput');
        const savingDurationLabel = document.getElementById('savingDurationLabel');
        const retirementDurationLabel = document.getElementById('retirementDurationLabel');
        
        // Assets
        const currentBTCInput = document.getElementById('currentBTCInput');
        const btcValueTHB = document.getElementById('btcValueTHB');
        const assetStock = document.getElementById('assetStock');
        const assetGold = document.getElementById('assetGold');
        const assetOtherCrypto = document.getElementById('assetOtherCrypto');
        const assetCash = document.getElementById('assetCash');
        const assetFunds = document.getElementById('assetFunds');
        const totalAssetsDisplay = document.getElementById('totalAssetsDisplay');

        // Goals
        const monthlyExpenseSlider = document.getElementById('monthlyExpense');
        const monthlyExpenseNum = document.getElementById('monthlyExpenseNum');
        const inflationRateInput = document.getElementById('inflationRate');
        const btcPriceScenario = document.getElementById('btcPriceScenario');
        const btcFuturePriceInput = document.getElementById('btcFuturePrice');

        // Dashboard
        const totalCashNeededDisplay = document.getElementById('totalCashNeeded');
        const currentNetWorthDisplay = document.getElementById('currentNetWorth');
        const shortfallTHBDisplay = document.getElementById('shortfallTHB');
        const shortfallBTCDisplay = document.getElementById('shortfallBTC');
        const yearsToInvestLabel = document.getElementById('yearsToInvestLabel');
        const monthlyBTCTargetDisplay = document.getElementById('monthlyBTCTarget');
        const monthlyTHBTargetDisplay = document.getElementById('monthlyTHBTarget');

        // Live Elements
        const liveClock = document.getElementById('liveClock');
        const livePriceDisplay = document.getElementById('livePriceDisplay');

        // --- 1. Time & Price Fetching ---
        function updateClock() {
            const now = new Date();
            liveClock.innerText = `${now.toLocaleDateString('th-TH', {day:'numeric', month:'short', year:'numeric'})} ${now.toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'})}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        async function fetchPrice(manual = false) {
            if(manual) livePriceDisplay.innerText = "...";
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=thb');
                const data = await response.json();
                if (data.bitcoin && data.bitcoin.thb) {
                    currentBTCPrice = data.bitcoin.thb;
                    livePriceDisplay.innerText = `‡∏ø${currentBTCPrice.toLocaleString()}`;
                    calculate(); // Recalculate when price updates
                }
            } catch (error) {
                console.error("Price fetch error");
                if(manual) livePriceDisplay.innerText = "Error";
            }
        }
        fetchPrice();
        setInterval(() => fetchPrice(), 60000);

        // --- 2. Helper: Format Money ---
        function fmtMoney(num) {
            return num.toLocaleString('th-TH', {maximumFractionDigits: 0});
        }
        function fmtMillion(num) {
            return (num / 1000000).toFixed(2) + " M";
        }

        // --- 3. Main Calculation ---
        function calculate() {
            // 1. Get Inputs
            let age = parseInt(currentAgeInput.value) || 30;
            let retireAge = parseInt(retireAgeInput.value) || 60;
            let dieAge = parseInt(dieAgeInput.value) || 80;
            
            // Validation & Time
            if(age < 1) age = 1;
            if(retireAge <= age) retireAge = age + 1;
            if(dieAge <= retireAge) dieAge = retireAge + 1;

            let yearsToSave = retireAge - age;
            let yearsRetire = dieAge - retireAge;
            
            savingDurationLabel.innerText = yearsToSave;
            retirementDurationLabel.innerText = yearsRetire;
            yearsToInvestLabel.innerText = yearsToSave;

            // 2. Assets Calculation
            let btcAmount = parseFloat(currentBTCInput.value) || 0;
            let btcValue = btcAmount * currentBTCPrice;
            btcValueTHB.innerText = `‚âà ${fmtMoney(btcValue)} ‡∏ö‡∏≤‡∏ó`;

            let valStock = parseFloat(assetStock.value) || 0;
            let valGold = parseFloat(assetGold.value) || 0;
            let valOtherCrypto = parseFloat(assetOtherCrypto.value) || 0;
            let valCash = parseFloat(assetCash.value) || 0;
            let valFunds = parseFloat(assetFunds.value) || 0;

            let totalCurrentAssets = btcValue + valStock + valGold + valOtherCrypto + valCash + valFunds;
            totalAssetsDisplay.innerText = fmtMoney(totalCurrentAssets);
            currentNetWorthDisplay.innerText = fmtMillion(totalCurrentAssets);

            // 3. Goal Calculation
            let monthlyExp = parseInt(monthlyExpenseNum.value) || 0;
            let inflation = parseFloat(inflationRateInput.value) / 100;
            let futureBTCPrice = parseInt(btcFuturePriceInput.value);

            // FV of expense
            let futureMonthlyExp = monthlyExp * Math.pow((1 + inflation), yearsToSave);
            // Total Pot Needed (Simple: Future Monthly * 12 * Years Retire)
            let totalNeeded = futureMonthlyExp * 12 * yearsRetire;
            totalCashNeededDisplay.innerText = fmtMillion(totalNeeded);

            // 4. Shortfall Logic
            // Shortfall = Total Needed - Current Assets
            // Note: We assume Current Assets stay flat in value or grow at inflation? 
            // To be conservative, let's assume they just act as principal reduction.
            let shortfall = totalNeeded - totalCurrentAssets;
            
            if (shortfall <= 0) {
                // Goal Achieved
                shortfallTHBDisplay.innerText = "‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß! üéâ";
                shortfallTHBDisplay.classList.replace('text-red-400', 'text-green-400');
                shortfallBTCDisplay.innerText = "0.0000";
                monthlyBTCTargetDisplay.innerText = "0.000000";
                monthlyTHBTargetDisplay.innerText = "0 ‡∏ö‡∏≤‡∏ó";
            } else {
                // Still need more
                shortfallTHBDisplay.innerText = fmtMoney(shortfall);
                shortfallTHBDisplay.classList.replace('text-green-400', 'text-red-400');

                // Convert Shortfall to BTC Target
                let btcNeededForShortfall = shortfall / futureBTCPrice;
                shortfallBTCDisplay.innerText = btcNeededForShortfall.toFixed(4);

                // Monthly Plan
                let monthsToSave = yearsToSave * 12;
                let monthlyBTC = btcNeededForShortfall / monthsToSave;
                let monthlyTHB = monthlyBTC * currentBTCPrice;

                monthlyBTCTargetDisplay.innerText = monthlyBTC.toFixed(6);
                monthlyTHBTargetDisplay.innerText = fmtMoney(Math.ceil(monthlyTHB)) + " ‡∏ö‡∏≤‡∏ó";
            }
        }

        // --- 4. Event Listeners ---
        const inputs = [
            currentAgeInput, retireAgeInput, dieAgeInput, 
            currentBTCInput, assetStock, assetGold, assetOtherCrypto, assetCash, assetFunds,
            monthlyExpenseNum, inflationRateInput, btcFuturePriceInput
        ];

        inputs.forEach(input => input.addEventListener('input', calculate));

        monthlyExpenseSlider.addEventListener('input', (e) => {
            monthlyExpenseNum.value = e.target.value;
            calculate();
        });

        monthlyExpenseNum.addEventListener('input', (e) => {
            monthlyExpenseSlider.value = e.target.value;
            calculate();
        });

        btcPriceScenario.addEventListener('change', (e) => {
            if (e.target.value === 'custom') {
                // Enable input for custom
                btcFuturePriceInput.disabled = false;
                btcFuturePriceInput.classList.remove('bg-gray-100', 'text-gray-500');
                btcFuturePriceInput.classList.add('bg-white', 'text-indigo-700', 'font-bold');
                btcFuturePriceInput.focus();
            } else {
                // Disable and set value from dropdown
                btcFuturePriceInput.disabled = true;
                btcFuturePriceInput.value = e.target.value;
                btcFuturePriceInput.classList.add('bg-gray-100', 'text-gray-500');
                btcFuturePriceInput.classList.remove('bg-white', 'text-indigo-700', 'font-bold');
                calculate();
            }
        });
        
        // Add event listener for the custom input itself
        btcFuturePriceInput.addEventListener('input', calculate);

        // Init
        calculate();

    </script>
</body>
</html>
